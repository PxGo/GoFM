(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3995:function(t,e,s){Promise.resolve().then(s.bind(s,4274))},4274:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return l}});var i=s(9268),n=s(5846),r=s.n(n),a=s(6006),o=s(4821);class c extends a.Component{componentDidMount(){this.setTimerToUpdateRunningTime(),this.initInfo().catch(t=>{this.setState({errorMessage:t.message||t.toString()})}),this.initWebsocket()}componentWillUnmount(){this.clearTimer(),this.destroyWebsocket()}setPlayerStatus(){"playing"===this.state.playerStatus?this.stop():"stopped"===this.state.playerStatus?this.play():"loading"===this.state.playerStatus&&this.stop()}play(){this.audioRef.current&&this.state.fmInfo&&(this.audioRef.current.src="",this.audioRef.current.src=this.state.fmInfo.url,this.audioRef.current.play().then(()=>{this.setState({playerStatus:"playing"})}).catch(t=>{this.setState({playerStatus:"stopped"})}))}stop(){this.audioRef.current&&(this.audioRef.current.pause(),this.setState({playerStatus:"stopped"}))}initInfo(){return fetch("/info").then(t=>t.json()).then(t=>{let{name:e,version:s,time:i,FMInfo:n}=t.data,{cover:r,title:a,artist:o,sampleRate:c,bitRate:l,url:h}=n;this.setState({serverInfo:{name:e,version:s,time:i},fmInfo:{cover:r,title:a,artist:o,sampleRate:c,bitRate:l,url:h}})})}initWebsocket(){let t=t=>{console.log(t)},e=()=>{this.setState({websocketStatus:"disconnected"}),this.destroyWebsocket(),setTimeout(()=>{this.initWebsocket()},5e3)},s=()=>{this.setState({websocketStatus:"connected"})},i=t=>{this.setState({fmInfo:JSON.parse(t.data)})};this.socket=new WebSocket(function(){if(!window)return"";let t="https:"===window.location.protocol?"wss://":"ws://",e=window.location.hostname,s=window.location.port||("wss://"===t?"443":"80");return t+e+":"+s+"/ws"}()),this.socket.addEventListener("error",t),this.socket.addEventListener("close",e),this.socket.addEventListener("open",s),this.socket.addEventListener("message",i),this.destroyWebsocket=()=>{this.socket&&(this.socket.removeEventListener("error",t),this.socket.removeEventListener("close",e),this.socket.removeEventListener("open",s),this.socket.removeEventListener("message",i))}}setTimerToUpdateRunningTime(){let t=setTimeout(()=>{let t,e,s,i;this.state.serverInfo&&this.setState({runningTime:(e=Math.floor((t=Math.floor((Date.now()-this.state.serverInfo.time)/1e3))/3600),s=Math.floor((t-=3600*e)/60),i=t-60*s,"".concat(String(e).padStart(2,"0"),":").concat(String(s).padStart(2,"0"),":").concat(String(i).padStart(2,"0")))}),this.setTimerToUpdateRunningTime()},1e3);this.setState({timer:t})}clearTimer(){this.state.timer&&clearTimeout(this.state.timer)}render(){let{runningTime:t,errorMessage:e,serverInfo:s,fmInfo:n,playerStatus:a}=this.state;return(0,i.jsxs)("main",{className:"flex justify-center items-center h-screen w-screen bg-gray-100",children:[(0,i.jsx)("title",{children:s?s.name:"GoFM"}),(0,i.jsx)("link",{rel:"shortcut icon",type:"image/png",href:this.state.fmInfo?this.state.fmInfo.cover:"/favicon.ico"}),e?(0,i.jsx)(h,{children:e}):s&&n?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{backgroundImage:"url(".concat(n.cover,")"),filter:"blur(100px)",WebkitFilter:"blur(100px)"},className:"h-full w-full fixed left-0 top-0 z-10 bg-center bg-cover",children:(0,i.jsx)("div",{style:{height:"100%",width:"100%",backgroundColor:"rgba(255,255,255,0.6)"}})}),(0,i.jsxs)("div",{className:"w-96 mx-auto max-w-full p-4 z-20",children:[(0,i.jsxs)("div",{className:"mb-2 flex justify-between items-center",children:[(0,i.jsx)("div",{className:"text-left",children:s.name}),(0,i.jsx)("div",{style:{fontFamily:"Arial, sans-serif"},className:"text-right text-gray-700 text-sm",children:t})]}),(0,i.jsxs)("div",{className:"bg-white rounded-md overflow-hidden h-24 flex mb-2 shadow-sm",children:[(0,i.jsx)("div",{className:"w-24 h-24 flex-shrink-0 ",children:(0,i.jsx)("img",{src:n.cover,className:"h-full w-full",alt:"12"})}),(0,i.jsxs)("div",{className:"pt-3 pb-3 pl-3 pr-3 flex-1 overflow-hidden",children:[(0,i.jsx)("div",{className:"h-6 truncate w-full font-bold text-md text-gray-700 mb-0",children:n.title}),(0,i.jsx)("div",{className:"h-5 truncate w-full text-sm mb-1 text-gray-700",children:n.artist}),(0,i.jsx)("div",{className:"h-6 truncate w-full text-sm text-gray-700 flex",children:(0,i.jsx)("div",{className:"h-6 w-6 flex justify-center items-center cursor-pointer select-none",onClick:()=>{this.setPlayerStatus()},children:"stopped"===a?(0,i.jsx)(o.wvg,{size:30}):(0,i.jsx)(o.xkl,{size:30})})})]})]}),(0,i.jsx)("audio",{ref:this.audioRef}),(0,i.jsx)("div",{className:"text-center text-xs text-gray-600",children:(0,i.jsxs)(r(),{href:"https://github.com/pxgo/GoFM",target:"_blank",children:["GoFM ",s.version]})})]})]}):(0,i.jsx)(h,{children:"Loading..."})]})}constructor(t){super(t),this.audioRef=a.createRef(),this.socket=null,this.destroyWebsocket=()=>{},this.state={errorMessage:"",runningTime:"00:00:00",timer:null,serverInfo:null,fmInfo:null,playerStatus:"stopped",websocketStatus:"connecting"}}}var l=c;function h(t){return(0,i.jsx)("div",{children:t.children})}}},function(t){t.O(0,[739,115,667,139,744],function(){return t(t.s=3995)}),_N_E=t.O()}]);